# Agent Zero — Архитектура и мозги агента

**Обновлено:** 2026-02-17
**Сервер:** `vzor@95.174.95.209`
**Данные:** `/home/vzor/agent-zero-data/` (в Docker монтируется как `/a0/usr`)

---

## Полная карта: откуда агент берёт информацию

```
ВСЕГДА (каждый разговор):
  _context.md + role.md              → знает кто он, что за проект, как работать

ПО ЗАПРОСУ (ищет когда нужно):
  memory/                            → вспоминает из прошлых разговоров
  knowledge/custom/main/             → ищет в справочниках и ментальных моделях
  RAGFlow (ragflow_search)           → ищет в тяжёлых документах (PDF, Excel)
```

---

## 1. РОЛЬ — кто агент и как думает

Эти два файла загружаются **В КАЖДОМ разговоре**. Агент никогда их не забывает.

```
agents/agent0/
├── _context.md                      ← ЧТО за проект (краткое описание, всегда на виду)
└── prompts/
    └── agent.system.main.role.md    ← КТО он, КАК работает, КАКИЕ правила соблюдает
```

| Файл | Назначение | Что писать |
|------|-----------|------------|
| `_context.md` | Бейджик — всегда на виду | Краткое описание проекта: 4 блока, 197 задач, инфраструктура |
| `role.md` | Должностная инструкция | Роль, компетенции, правила, алгоритмы работы |

**Как менять:** редактировать файлы на сервере. Изменения вступают в силу в следующем разговоре.

---

## 2. ПАМЯТЬ — что запомнил из разговоров

Автоматическая. Агент сам записывает важное после каждого разговора.

```
memory/
├── default/                         ← текстовые воспоминания
└── embeddings/                      ← векторные представления (для поиска по смыслу)
```

Настраивать не нужно. Чем больше работаешь с агентом — тем больше помнит.

---

## 3. ЗНАНИЯ — справочные материалы и ментальные модели

Файлы, которые агент **ищет по смыслу** через векторный поиск (FAISS).
При запуске Agent Zero автоматически индексирует все файлы из `knowledge/`.

```
knowledge/
├── custom/                          ← СЮДА класть свои файлы
│   ├── main/                        ← основная база знаний
│   │   ├── 00-vzor-overview.md          проект VZOR
│   │   ├── 01-server-infrastructure.md  инфраструктура сервера
│   │   ├── 02-deployment-procedures.md  процедуры деплоя
│   │   ├── 03-api-credentials.md        API ключи
│   │   ├── 04-vzor-task-system.md       система задач
│   │   ├── 05-vzor-dev-structure.md     структура разработки
│   │   │
│   │   └── mm_*.md                      99 МЕНТАЛЬНЫХ МОДЕЛЕЙ (см. раздел 8)
│   │
│   ├── solutions/                   ← решения проблем (агент пишет сюда сам)
│   └── fragments/                   ← фрагменты знаний
└── default/                         ← встроенные знания фреймворка (не трогать)
```

**Поддерживаемые форматы:** `.md`, `.txt`, `.pdf`, `.csv`, `.html`
**Как добавить:** положить файл в `knowledge/custom/main/` — будет проиндексирован автоматически.

---

## 4. ДОКУМЕНТЫ — тяжёлые файлы (RAGFlow)

Отдельный сервис для больших документов: PDF, Excel, сканы.

```
RAGFlow
├── Web:  http://95.174.95.209:8088
├── API:  http://95.174.95.209:9380
└── Ключ: ragflow-c36bd6a4202fcfefaed61f8e9df5456e
```

| База знаний | Содержимое |
|------------|-----------|
| Поставщики | Прайсы, коммерческие предложения |
| Проектирование | ТЗ, чертежи |
| Расчёты | Сметы, финмодели |
| Регламенты | СНиПы, ГОСТы |

Агент ищет там через инструмент `ragflow_search`.

---

## 5. ИНСТРУМЕНТЫ — что агент умеет делать

```
instruments/custom/
├── ragflow_search/                  ← поиск по документам RAGFlow
├── vzor_tasks/                      ← управление задачами в PostgreSQL
├── vzor_deploy/                     ← деплой изменений на сервер
├── vzor_diagnostics/                ← диагностика сервера
├── vzor_git/                        ← Git операции
└── vzor_backup/                     ← бэкапы
```

Каждый инструмент = папка с двумя файлами:
- `.md` — описание (агент читает чтобы понять когда использовать)
- `.py` — код (агент вызывает для выполнения)

---

## 6. РАБОЧАЯ ПАПКА — куда агент сохраняет файлы

```
workdir/                             ← созданные документы, отчёты, анализы
```

Доступ через FileBrowser: https://vzor-ai.com/fm

---

## 7. ПОДАГЕНТЫ — помощники

Главный агент (`agent0`) делегирует задачи подагентам автоматически.

```
agents/
├── agent0/                          ← ГЛАВНЫЙ агент (VZOR AI)
├── vzor-analyst/                    ← анализ данных, финмоделирование
├── vzor-planner/                    ← планирование, декомпозиция задач
├── vzor-deployer/                   ← деплой, серверные операции
├── vzor-debugger/                   ← отладка, диагностика
├── default/                         ← шаблон (не трогать)
├── developer/                       ← встроенный профиль
├── researcher/                      ← встроенный профиль
└── _example/                        ← пример (не трогать)
```

Каждый подагент имеет свои `_context.md` и `prompts/agent.system.main.role.md`.

---

## 8. МЕНТАЛЬНЫЕ МОДЕЛИ — система анализа проблем

99 ментальных моделей Чарли Мангера для структурированного анализа любых проблем.

### Что куда:

| Что | Куда на сервере | Зачем |
|-----|----------------|-------|
| 99 файлов моделей | `knowledge/custom/main/` | Агент ищет подходящие модели через векторный поиск |
| Алгоритм работы (пайплайн) | `agents/agent0/prompts/agent.system.main.role.md` | Агент знает 4-шаговый процесс анализа |

### Алгоритм работы (дописывается в role.md):

```
Шаг 1: ДИАГНОСТИКА — уточнить проблему (до 5 вопросов)
Шаг 2: ВЫБОР МОДЕЛЕЙ — найти в knowledge подходящие, выбрать макс. 3
Шаг 3: АНАЛИЗ — для каждой модели пройти раздел «Шаги мышления»
Шаг 4: СИНТЕЗ — собрать единый отчёт с рекомендациями
```

### 99 моделей по категориям:

| Категория | Кол-во | Примеры |
|-----------|--------|---------|
| Общие | 10 | Карта — не территория, Инверсия, Бритва Оккама |
| Наука | 20 | Энергия активации, Эволюция, Инерция |
| Системное мышление | 11 | Обратная связь, Узкие места, Эмерджентность |
| Математика | 7 | Выборка, Регрессия к среднему, Умножение на ноль |
| Экономика | 12 | Дефицит, Спрос и предложение, Пузыри |
| Искусство | 11 | Аудитория, Контраст, Фрейминг |
| Война | 5 | Асимметричная война, Война на два фронта |
| Человеческая природа | 23 | Доверие, Ошибка выжившего, Отрицание |

### Источник (локальная копия):

```
C:\Users\vzor\Desktop\ментальные мысли vzor 2\
├── GEMINI.md                        ← системный промпт (адаптировать в role.md)
├── Дополнительная_Информация/       ← два режима процесса (глубокий/быстрый)
├── Ментальные_Модели/               ← 99 файлов (скопировать в knowledge)
└── Рабочее_Пространство/            ← для результатов анализа
```

---

## Полная структура на сервере

```
/home/vzor/agent-zero-data/
│
├── agents/                              КТО агент и КАК думает
│   ├── agent0/                          Главный агент
│   │   ├── _context.md                  Контекст проекта (видит всегда)
│   │   └── prompts/
│   │       └── agent.system.main.role.md    Роль + алгоритм ментальных моделей
│   ├── vzor-analyst/                    Подагент: анализ
│   ├── vzor-planner/                    Подагент: планирование
│   ├── vzor-deployer/                   Подагент: деплой
│   └── vzor-debugger/                   Подагент: отладка
│
├── knowledge/                           ЧТО агент знает (векторный поиск)
│   ├── custom/main/                     Справочники + 99 ментальных моделей
│   ├── custom/solutions/                Решения проблем
│   └── default/                         Встроенные знания
│
├── memory/                              ЧТО запомнил из разговоров
│
├── instruments/custom/                  ЧТО умеет делать (инструменты)
│   ├── ragflow_search/                  Поиск в RAGFlow
│   ├── vzor_tasks/                      Задачи
│   ├── vzor_deploy/                     Деплой
│   ├── vzor_diagnostics/                Диагностика
│   ├── vzor_git/                        Git
│   └── vzor_backup/                     Бэкапы
│
├── workdir/                             Рабочая папка агента
├── settings.json                        Настройки (модели, API)
├── secrets.env                          Секреты
└── chats/                               История чатов
```
