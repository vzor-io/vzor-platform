# VZOR Invest — Ментальные модели для финансов

## Направление: акции, трейдинг, крипта, биржа

---

## 1. Происхождение технологии

### Автор оригинала: Tony Huang (Тони Хуанг)

Тони Хуанг — AI-инженер, который построил систему принятия инвестиционных решений на базе **Gemini CLI + Obsidian**. Его ключевая идея: вместо того чтобы спрашивать ИИ «стоит ли покупать акции X?» и получать поверхностный ответ, он создал **структурированный аналитический пайплайн**, в котором ИИ-агент:

1. Сначала диагностирует проблему и задаёт уточняющие вопросы
2. Сканирует библиотеку из 98 ментальных моделей и отбирает 3 наиболее релевантные
3. Применяет каждую модель пошагово, собирая доказательства
4. Синтезирует выводы всех моделей в единый аналитический отчёт

### Как работал у Хуана

- **Инструмент:** Gemini CLI (Google) + локальная папка Obsidian
- **System prompt:** файл `GEMINI.md` — загружался в контекст Gemini при каждом запуске
- **База знаний:** 98 файлов `.md` в папке `Mental_Models/` (8 подпапок по дисциплинам)
- **Рабочее пространство:** папка `WorkSpace/`, где агент создавал папки анализа с файлами
- **Пример:** кейс `25-07-18_16-30-00_nvidia_investment_decision` (анализ покупки акций NVIDIA)

### Как работает у нас (VZOR)

- **Инструмент:** Agent Zero (ИИ-агент в Docker на сервере VZOR)
- **System prompt:** файл `agent.system.main.role.md` — содержит тот же алгоритм из GEMINI.md
- **База знаний:** 99 файлов с префиксом `mm_` в `/home/vzor/agent-zero-data/knowledge/custom/main/`, индексированных через FAISS (векторный поиск)
- **Рабочее пространство:** `/a0/usr/workdir/`
- **Интерфейс:** чат на платформе VZOR (vzor-ai.com) с рендерингом Markdown

---

## 2. Кейс NVIDIA: как Хуанг анализировал покупку акций

Это реальный пример полного прохождения пайплайна — от вопроса до итогового отчёта.

### Вопрос пользователя

> «Should I invest in Nvidia? The stock price is so high, and AI is a hot topic.»

### Шаг 1: Диагностика проблемы

Агент НЕ бросился отвечать. Он сформулировал суть проблемы и задал **5 уточняющих вопросов**:

1. Каков ваш горизонт инвестирования? (1-2 года)
2. Какова ваша толерантность к риску? (максимум 10% потерь)
3. Оцените своё понимание полупроводниковой индустрии от 1 до 10? (3/10)
4. Какой процент портфеля вы готовы вложить? (25%)
5. Какова ваша цель? (долгосрочное накопление)

**Файл:** `problem_diagnosis.md`

Агент выявил **ключевое противоречие**: цель «долгосрочное накопление» конфликтует с коротким горизонтом (1-2 года), низкой толерантностью к риску (10%) и крупной долей портфеля (25%) в акции, которую пользователь не понимает (3/10).

### Шаг 2: Отбор моделей (Selection Funnel)

Из 98 моделей агент:
- Первичное сканирование: отобрал **12+ кандидатов**
- Глубокий анализ: оценил 5 наиболее релевантных
- Финальный выбор: **3 модели**

**Файл:** `mental_models_selected.md`

| Ранг | Модель | Почему выбрана |
|---|---|---|
| 1 | **Круг компетенций** (m02) | Пользователь оценил своё знание индустрии на 3/10 — решение за пределами его компетенции |
| 2 | **Пузыри** (m59) | Экспоненциальный рост акции, хайп вокруг ИИ — классические признаки пузыря |
| 3 | **Социальное доказательство** (m84) | Пользователь спрашивает потому что «все говорят» — влияние стадного поведения |

### Шаг 3: Детальный анализ по каждой модели

#### Модель 1: Круг компетенций

Агент прошёл по **5 шагам мышления** модели:

1. **Определи свои ключевые компетенции** — пользователь разбирается в AI-моделях, но не в полупроводниках
2. **Определи границы** — знание индустрии: 3/10, опыт инвестирования: нулевой
3. **Действуй внутри круга** — вложение 25% портфеля в отдельную акцию = ставка за пределами компетенций
4. **Расширяй круг осознанно** — нужны месяцы изучения (10-K отчёты, конкуренты, CUDA)
5. **Консультируйся с экспертами** — альтернатива: ETF-фонды (VOO, QQQ)

**Вывод:** Инвестиция в NVIDIA **вне круга компетенций** пользователя.

**Файл:** `reasoning_m02_circle_of_competence.md`

#### Модель 2: Пузыри

Агент прошёл по шагам:

1. **Анализ цены vs внутренней стоимости** — P/E ~54-55, рост +239% в 2023, +171% в 2024
2. **Выяви соблазнительный нарратив** — «ИИ — революция масштаба интернета, NVIDIA — единственный поставщик»
3. **Найди социальное доказательство и FOMO** — массовый интерес ритейл-инвесторов
4. **Ищи приток «глупых денег»** — популярность у неопытных инвесторов = классический признак
5. **Вернись к фундаментальной стоимости** — бизнес сильный, но цена заложила годы идеального роста

**Вывод:** «Фундаментально обоснованный пузырь» — отличная компания по потенциально опасной цене.

**Файл:** `reasoning_m59_bubbles.md`

#### Модель 3: Социальное доказательство

1. **Определи влияние** — интерес к NVIDIA вызван тем, что «все об этом говорят»
2. **Поставь под сомнение знания толпы** — толпа покупает потому что цена растёт, а не потому что понимает бизнес
3. **Думай от первых принципов** — факты: низкое знание (3/10), низкая толерантность (10%), крупная доля (25%)
4. **Ищи несогласных** — value-инвесторы считают акцию переоценённой, историки рынка напоминают про dotcom
5. **Действуй независимо** — рациональный выбор: воздержаться от покупки

**Файл:** `reasoning_m84_social_proof.md`

### Шаг 4: Синтез — главная ценность решётки

Три модели, сплетённые вместе, дали картину, которую ни одна модель по отдельности не даёт:

- **Круг компетенций** определяет проблему: у вас нет экспертизы для этого решения
- **Социальное доказательство** объясняет *почему* вы всё равно хотите это сделать: давление толпы
- **Пузыри** объясняет *опасность* поддаться этому давлению: покупка переоценённого актива

> «Решётка раскрывает классическую инвестиционную ловушку: неопытный инвестор, движимый рыночным хайпом, покупает волатильный и потенциально переоценённый актив.»

### Итоговые рекомендации

1. **НЕ покупать отдельные акции NVIDIA** — не соответствует профилю риска
2. **Получить экспозицию через ETF** — S&P 500 (VOO, IVV) или NASDAQ-100 (QQQ) — диверсификация при сохранении участия в росте ИИ
3. **Расширить круг компетенций** — если хочется инвестировать в отдельные акции, сначала потратить месяцы на изучение индустрии

**Файл:** `analysis_report.md`

---

## 3. Финансовые файлы полного анализа

Каждый анализ создаёт папку с фиксированной структурой:

```
workdir/
+-- 25-07-18_16-30-00_nvidia_investment_decision/
    |-- problem_diagnosis.md          # Диагностика: суть проблемы + профиль пользователя
    |-- questionnaire.md              # 5 вопросов + ответы пользователя
    |-- mental_models_selected.md     # Воронка отбора: 98 -> 12 -> 5 -> 3 модели
    |-- reasoning_m02_circle_of_competence.md    # Анализ через Круг компетенций
    |-- reasoning_m59_bubbles.md                 # Анализ через Пузыри
    |-- reasoning_m84_social_proof.md             # Анализ через Социальное доказательство
    +-- analysis_report.md            # Итоговый отчёт: синтез + рекомендации
```

---

## 4. Какие модели наиболее релевантны для финансов

Из 99 моделей в библиотеке, следующие наиболее часто применимы к финансовым решениям:

### Прямые финансовые модели (Экономика)

| Модель | Применение в финансах |
|---|---|
| **Спрос и предложение** (m49) | Анализ ценообразования актива, ликвидность |
| **Альтернативные издержки** (m51) | «Что я теряю, не вложив эти деньги в другой актив?» |
| **Монополия и конкуренция** (m56) | Оценка конкурентной позиции компании, «мoат» |
| **Пузыри** (m59) | Определение спекулятивного перегрева рынка |
| **Дефицит** (m48) | Оценка ограниченности актива (крипта, редкие ресурсы) |
| **Закон Грешема** (m58) | Динамика вытеснения плохих активов хорошими |

### Модели принятия решений (Общие)

| Модель | Применение в финансах |
|---|---|
| **Круг компетенций** (m02) | «Достаточно ли я разбираюсь в этом активе?» |
| **Мышление от первых принципов** (m03) | Деконструкция хайпа, анализ фундаментальной стоимости |
| **Мышление второго порядка** (m05) | «Если все покупают — что будет дальше?» |
| **Вероятностное мышление** (m06) | Оценка шансов разных сценариев |
| **Инверсия** (m07) | «Что может пойти не так?» |
| **Бритва Оккама** (m09) | Простейшее объяснение роста/падения цены |

### Системные модели

| Модель | Применение в финансах |
|---|---|
| **Обратная связь** (m30) | Циклы бум/крах, самоусиливающиеся тренды |
| **Запас прочности** (m34) | Margin of Safety — Баффет/Грэхем, буфер от ошибки |
| **Критическая масса** (m37) | Тipping points в рыночных трендах |
| **Закон убывающей отдачи** (m40) | Когда дальнейшее вложение перестаёт давать результат |

### Психологические модели (Человеческая природа)

| Модель | Применение в финансах |
|---|---|
| **Социальное доказательство** (m84) | Стадное поведение на рынке, FOMO |
| **Предвзятость подтверждения** (m98) | Ищем только аргументы «за» покупку |
| **Ошибка выжившего** (m96) | Видим только успешных трейдеров, игнорируем потери |
| **Нарративный инстинкт** (m85) | Сила историй о «следующем Bitcoin» или «новом Amazon» |
| **Склонность к действию** (m97) | «Надо что-то делать» вместо «подождать и подумать» |
| **Влияние стресса** (m95) | Паника при просадке, иррациональные продажи |
| **Предвзятость первого вывода** (m88) | Зафиксировался на первом тикере и не рассматриваешь альтернативы |

---

## 5. Промпт агента для направления «Финансы»

Ниже — дополнение к основному промпту Agent Zero для финансового направления. Этот блок добавляется в `agent.system.main.role.md` или загружается как отдельный файл knowledge.

### Роль

```
Ты — финансовый аналитик VZOR Invest, специализирующийся на анализе инвестиционных
решений с применением решётки ментальных моделей Чарли Мангера. Твоя задача — помочь
пользователю принять обоснованное решение по акциям, криптоактивам, ETF и другим
биржевым инструментам.
```

### Контекст направления

```
VZOR Invest — направление платформы VZOR, занимающееся:
- Анализом акций (US, RU рынки)
- Криптовалютами (BTC, ETH, альткоины)
- ETF-фондами и портфельным управлением
- Трейдингом (свинг, позиционный)

Ты НЕ даёшь финансовых советов. Ты помогаешь пользователю ДУМАТЬ
структурированно о своих инвестиционных решениях.
```

### Финансовые ключевые слова для отбора моделей

При диагностике проблемы обращай внимание на следующие триггеры:

**Оценка актива:**
- P/E, P/S, EV/EBITDA, Forward P/E, DCF
- Внутренняя стоимость, справедливая цена
- Переоценён / недооценён

**Управление портфелем:**
- Диверсификация, ребалансировка, аллокация
- Просадка (drawdown), волатильность
- Стоп-лосс, тейк-профит, риск-менеджмент

**Рыночные сигналы:**
- Тренд, поддержка, сопротивление
- Объём торгов, open interest
- Хайп, FOMO, медвежий/бычий рынок

**Криптовалюты:**
- Токеномика, халвинг, стейкинг
- DeFi, DEX, ликвидность пула
- Whitepaper, roadmap, комьюнити

**Трейдинг:**
- Маржинальная торговля, плечо (leverage)
- Шорт, лонг, фьючерсы, опционы
- Таймфреймы, точка входа/выхода

### Специфические правила для финансового анализа

1. **Всегда начинай с профиля инвестора** — горизонт, толерантность к риску, уровень знаний, размер позиции
2. **Проверяй «Круг компетенций»** — если пользователь оценивает своё понимание актива < 5/10, это красный флаг
3. **Всегда проверяй на признаки пузыря** — экспоненциальный рост + массовый хайп + FOMO = обязательная проверка через модель «Пузыри»
4. **Ищи когнитивные искажения** — FOMO, предвзятость подтверждения, стадное поведение — основные враги инвестора
5. **Предлагай альтернативы** — если прямая покупка актива слишком рискованна, предлагай ETF / DCA / расширение круга компетенций
6. **Используй веб-поиск** — актуальные данные P/E, цена акции, новости компании, конкуренты

---

## 6. Память агента

Агент должен помнить контекст между сессиями. Для этого в базу знаний загружаются файлы-памятки:

### Структура файлов памяти

```
knowledge/custom/main/
|-- mm_*.md                           # 99 ментальных моделей
|-- fin_user_profile.md               # Профиль инвестора (заполняется при первом анализе)
|-- fin_portfolio_context.md          # Текущий портфель, позиции, аллокация
|-- fin_analysis_history.md           # Список проведённых анализов с датами и выводами
+-- fin_watchlist.md                  # Активы под наблюдением
```

### Пример файла профиля: `fin_user_profile.md`

```markdown
# Профиль инвестора

## Общие параметры
- Горизонт: 3-5 лет
- Толерантность к риску: средняя (max просадка 20%)
- Уровень знаний: акции 6/10, крипта 4/10, макроэкономика 5/10
- Размер портфеля: конфиденциально

## Текущая аллокация
- 40% — индексные ETF (VOO, QQQ)
- 30% — отдельные акции (AAPL, MSFT, NVDA)
- 20% — крипта (BTC, ETH)
- 10% — кэш

## Прошлые решения
- 2025-07: Анализ NVIDIA -> решение: купить через QQQ вместо прямой позиции
- 2025-09: Анализ BTC -> решение: DCA $200/мес

## Когнитивные паттерны (выявлены агентом)
- Склонность к FOMO при хайпе
- Тенденция держать убыточные позиции (sunk cost)
- Хорошо реагирует на структурированный анализ
```

### Как агент использует память

1. При новом запросе агент читает `fin_user_profile.md` и `fin_portfolio_context.md`
2. Учитывает предыдущие анализы из `fin_analysis_history.md`
3. Персонализирует анкету (не спрашивает то, что уже известно)
4. Обновляет файлы после каждого завершённого анализа
5. Отслеживает когнитивные паттерны пользователя и предупреждает о них

---

## 7. Типовые запросы для финансового блока

### Акции

- «Стоит ли покупать NVIDIA по текущей цене?»
- «Сравни AAPL и MSFT для долгосрочного портфеля»
- «Моя позиция в Tesla упала на 30%, продавать или держать?»
- «Какие риски у китайских акций (BABA, JD)?»

### Крипта

- «Стоит ли входить в BTC сейчас или ждать коррекции?»
- «Оцени проект Solana через ментальные модели»
- «У меня 70% портфеля в одном альткоине, это нормально?»

### Портфель

- «Оцени мой портфель: 50% NVDA, 30% BTC, 20% кэш»
- «Как ребалансировать портфель при медвежьем рынке?»
- «Нужна ли мне диверсификация если я верю в ИИ?»

### Трейдинг

- «Вижу паттерн "голова и плечи" на графике, входить в шорт?»
- «Стоит ли использовать плечо x5 для позиции?»
- «Как управлять рисками при свинг-трейдинге?»

### Как агент обрабатывает финансовый запрос

Пример: пользователь спрашивает «Стоит ли покупать NVIDIA?»

```
Шаг 1: Диагностика
|-- Читает fin_user_profile.md (если есть)
|-- Уточняет: горизонт, риск, размер позиции, уровень знаний
+-- Создаёт: problem_diagnosis.md

Шаг 2: Отбор моделей
|-- Сканирует 99 моделей -> 15 кандидатов
|-- Глубокий анализ 6 -> финальные 3
|-- Типичные модели для акций:
|   |-- Круг компетенций (знает ли пользователь индустрию?)
|   |-- Пузыри (переоценён ли актив?)
|   +-- Запас прочности / Инверсия / Социальное доказательство
+-- Создаёт: mental_models_selected.md

Шаг 3: Анализ
|-- reasoning_m02_circle_of_competence.md
|-- reasoning_m59_bubbles.md
+-- reasoning_m34_margin_of_safety.md

Шаг 4: Синтез
|-- Сплетает модели воедино
|-- Находит пересечения и противоречия
|-- Создаёт: analysis_report.md
+-- Обновляет: fin_analysis_history.md
```

---

## 8. Отличия от оригинала Хуана

| Параметр | Хуанг (оригинал) | VZOR Invest |
|---|---|---|
| **Платформа** | Gemini CLI + Obsidian (локально) | Agent Zero на сервере VZOR |
| **Интерфейс** | Терминал | Веб-чат с Markdown-рендерингом |
| **Поиск моделей** | По имени файла | FAISS векторный поиск + имя файла |
| **Язык** | Английский | Русский (модели переведены) |
| **Веб-поиск** | Google Search (через Gemini) | ragflow_search + веб-поиск |
| **Память** | Нет (каждая сессия с нуля) | Файлы профиля + история анализов |
| **Режимы** | Глубокий / быстрый | Глубокий / быстрый |
| **Направления** | Универсальный | Специализация: Development, Invest, Estate |
| **Доступ** | Только разработчик | Все пользователи платформы VZOR |

---

## 9. Что нужно сделать для запуска финансового блока

### Уже готово
- [x] 99 ментальных моделей загружены на сервер (файлы mm_*.md)
- [x] Промпт Agent Zero содержит полный алгоритм из GEMINI.md
- [x] FAISS индексация работает
- [x] Markdown рендерится в чате
- [x] Два режима работы (глубокий/быстрый)

### Нужно сделать
- [ ] Создать файл fin_user_profile.md — шаблон профиля инвестора в knowledge
- [ ] Создать файл fin_portfolio_context.md — шаблон портфеля в knowledge
- [ ] Создать файл fin_analysis_history.md — пустой, для накопления истории
- [ ] Добавить финансовый блок в промпт агента (роль + ключевые слова + правила)
- [ ] Провести тестовый анализ: «Стоит ли покупать NVIDIA?» (повторить кейс Хуана)
- [ ] Провести тестовый анализ: крипто-кейс (BTC или ETH)
- [ ] Настроить веб-поиск агента для получения актуальных финансовых данных (P/E, цена, новости)
