<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>VZOR</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400&display=swap');

*{margin:0;padding:0;box-sizing:border-box}
html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{
  font-family:'Inter',-apple-system,system-ui,sans-serif;
  background:#000;color:#fff;
  overflow-x:hidden;cursor:default;
}
::selection{background:rgba(255,255,255,.15);color:#fff}

/* ═══ SCROLL RUNWAY ═══ */
.runway{height:520vh;position:relative}

/* ═══ STICKY STAGE ═══ */
.stage{
  position:sticky;top:0;
  width:100vw;height:100vh;
  overflow:hidden;
  z-index:1;
}

/* ═══ FRACTAL IMAGE ═══ */
.fractal-wrap{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  perspective:1200px;
}
#fractal{
  --sz:min(92vw,92vh);
  width:var(--sz);height:var(--sz);
  object-fit:contain;
  will-change:transform,opacity,filter;
  opacity:0;
  filter:brightness(1);
  transition:filter .3s ease-out;
}
/* Color glow behind fractal when direction active */
.fractal-glow{
  position:absolute;
  width:55vmin;height:55vmin;
  border-radius:50%;
  filter:blur(80px);
  opacity:0;
  transition:opacity 1.2s cubic-bezier(.22,1,.36,1), background 1s;
  pointer-events:none;
}

/* ═══ SVG ARCS OVERLAY ═══ */
#arcsSvg{
  position:absolute;inset:0;
  width:100%;height:100%;
  pointer-events:none;
  z-index:5;
}
.arc-path{
  fill:none;
  stroke-linecap:round;
  opacity:0;
  transition:opacity .6s;
}
.arc-path.show{opacity:1}
.arc-dot{
  opacity:0;
  transition:opacity .6s .4s;
}
.arc-dot.show{opacity:1}

/* ═══ DATA LABELS (appear around arcs) ═══ */
.data-label{
  position:absolute;
  font-size:clamp(9px,.85vw,13px);
  font-weight:300;
  letter-spacing:.06em;
  color:rgba(255,255,255,0);
  white-space:nowrap;
  pointer-events:none;
  transition:color .5s,transform .5s cubic-bezier(.22,1,.36,1);
  transform:translateY(5px);
}
.data-label.show{
  color:rgba(255,255,255,.5);
  transform:translateY(0);
}
.data-label::before{
  content:'';
  display:inline-block;
  width:6px;height:6px;
  border-radius:50%;
  margin-right:8px;
  vertical-align:middle;
  opacity:.5;
}
.data-label[data-c="blue"]::before{background:#5B9EFF}
.data-label[data-c="amber"]::before{background:#FBBF24}
.data-label[data-c="violet"]::before{background:#A78BFA}

/* Small metric badges */
.data-metric{
  position:absolute;
  font-size:clamp(8px,.7vw,11px);
  font-weight:200;
  letter-spacing:.08em;
  color:rgba(255,255,255,0);
  pointer-events:none;
  transition:color .5s .2s;
  text-transform:uppercase;
}
.data-metric.show{color:rgba(255,255,255,.25)}

/* ═══ DATA LABELS CONTAINER ═══ */
#dataLabels{
  position:absolute;inset:0;
  width:100%;height:100%;
  pointer-events:none;
  z-index:6;
}

/* ═══ SCENES ═══ */
.scene{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  pointer-events:none;
  opacity:0;
  will-change:opacity;
}

/* Scene: Hero Title */
.scene--title h1{
  font-size:clamp(54px,10vw,160px);
  font-weight:100;
  letter-spacing:.35em;
  text-indent:.35em;
  text-transform:uppercase;
  color:rgba(255,255,255,.88);
}

/* Scene: Tagline */
.scene--tag p{
  font-size:clamp(15px,2.2vw,30px);
  font-weight:200;
  letter-spacing:.1em;
  color:rgba(255,255,255,.7);
  text-align:center;
  max-width:80vw;
}

/* Scene: Directions */
.scene--dirs{
  align-items:stretch;
  justify-content:stretch;
}
.dir-btn{
  position:absolute;
  background:none;border:none;outline:none;
  font-family:inherit;
  font-size:clamp(11px,1.2vw,17px);
  font-weight:300;
  letter-spacing:.2em;
  text-transform:uppercase;
  color:rgba(255,255,255,.35);
  cursor:pointer;
  pointer-events:auto;
  padding:10px 0;
  transition:color .4s, letter-spacing .5s ease-out, text-shadow .4s ease-out, transform .15s ease-out;
  z-index:10;
  text-shadow:0 0 0px transparent;
}
.dir-btn:hover{color:rgba(255,255,255,.7)}
.dir-btn.active{color:rgba(255,255,255,.95)}

/* Direction button connector lines */
.dir-line{
  position:absolute;
  background:rgba(255,255,255,.06);
  transition:background .5s, height .5s;
}
.dir-btn.active + .dir-line,
.dir-btn:hover + .dir-line{background:rgba(255,255,255,.15)}

/* Position direction buttons around the fractal */
.dir-dev{top:12%;left:8%}
.dir-dev-line{width:1px;height:50px;top:calc(12% + 38px);left:calc(8% + 60px);transform:rotate(35deg);transform-origin:top}
.dir-fin{top:12%;right:8%}
.dir-fin-line{width:1px;height:50px;top:calc(12% + 38px);right:calc(8% + 40px);transform:rotate(-35deg);transform-origin:top}
.dir-re{bottom:10%;left:50%;transform:translateX(-50%)}
.dir-re-line{width:1px;height:50px;bottom:calc(10% + 38px);left:50%;transform-origin:bottom}

/* Scene: Statement */
.scene--stmt{flex-direction:column;gap:1.5rem}
.scene--stmt h2{
  font-size:clamp(22px,3.8vw,56px);
  font-weight:200;
  letter-spacing:.03em;
  text-align:center;
  line-height:1.45;
  color:rgba(255,255,255,.88);
}
.scene--stmt p{
  font-size:clamp(11px,1.1vw,15px);
  font-weight:200;
  letter-spacing:.06em;
  text-align:center;
  color:rgba(255,255,255,.28);
}

/* Scene: CTA */
.scene--cta{flex-direction:column;gap:5vh}
.cta-title{
  font-size:clamp(44px,8vw,120px);
  font-weight:100;
  letter-spacing:.35em;
  text-indent:.35em;
  text-transform:uppercase;
  color:rgba(255,255,255,.65);
}
.cta-link{
  display:inline-block;
  font-family:inherit;
  font-size:clamp(10px,.95vw,14px);
  font-weight:300;
  letter-spacing:.25em;
  text-transform:uppercase;
  text-decoration:none;
  color:rgba(255,255,255,.35);
  padding:16px 56px;
  border:1px solid rgba(255,255,255,.1);
  transition:color .5s,border-color .5s,letter-spacing .5s;
  pointer-events:auto;
}
.cta-link:hover{
  color:rgba(255,255,255,.85);
  border-color:rgba(255,255,255,.3);
  letter-spacing:.3em;
}

/* ═══ FIXED ELEMENTS ═══ */
.logo{
  position:fixed;top:3.5vh;left:4vw;
  font-size:clamp(11px,1vw,15px);
  font-weight:200;
  letter-spacing:.4em;
  text-transform:uppercase;
  color:rgba(255,255,255,.5);
  z-index:100;
  opacity:0;
  transition:opacity .8s;
  pointer-events:none;
}

.scroll-ind{
  position:fixed;bottom:3.5vh;left:50%;
  transform:translateX(-50%);
  z-index:100;
  opacity:0;
  transition:opacity .6s;
}
.scroll-ind i{
  display:block;width:1px;height:36px;
  background:linear-gradient(rgba(255,255,255,0),rgba(255,255,255,.35));
  animation:pulse-line 2.4s ease-in-out infinite;
}
@keyframes pulse-line{
  0%,100%{opacity:.2;transform:scaleY(.55)}
  50%{opacity:1;transform:scaleY(1)}
}

/* ═══ ENTRY ANIMATION ═══ */
@keyframes fractal-enter{
  0%{opacity:0;filter:brightness(.3) blur(8px);transform:scale(.93)}
  100%{opacity:1;filter:brightness(1) blur(0px);transform:scale(1)}
}
.fractal-entered{
  animation:fractal-enter 2.6s cubic-bezier(.22,1,.36,1) forwards;
}

/* ═══ RESPONSIVE ═══ */
@media(max-width:768px){
  .dir-dev{top:8%;left:4%}
  .dir-fin{top:8%;right:4%}
  .dir-re{bottom:6%}
  .data-label{font-size:9px}
  .data-metric{font-size:8px}
  .dir-btn{font-size:11px;letter-spacing:.12em}
}
@media(max-width:480px){
  .scene--title h1{letter-spacing:.2em;text-indent:.2em}
  .cta-title{letter-spacing:.2em;text-indent:.2em}
  #fractal{--sz:98vw}
}
</style>
</head>
<body>

<!-- Fixed: Logo -->
<div class="logo" id="logo">VZOR</div>

<!-- Fixed: Scroll indicator -->
<div class="scroll-ind" id="scrollInd"><i></i></div>

<!-- Scroll runway -->
<div class="runway">
<div class="stage" id="stage">

  <!-- Fractal image -->
  <div class="fractal-wrap">
    <div class="fractal-glow" id="glow"></div>
    <img id="fractal" src="fractal.jpg" alt="">
  </div>

  <!-- SVG arcs overlay -->
  <svg id="arcsSvg" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet"></svg>

  <!-- Data labels container -->
  <div id="dataLabels"></div>

  <!-- Scene: Title -->
  <div class="scene scene--title" id="sTitle">
    <h1>VZOR</h1>
  </div>

  <!-- Scene: Tagline -->
  <div class="scene scene--tag" id="sTag">
    <p>Видеть структуру решений</p>
  </div>

  <!-- Scene: Directions -->
  <div class="scene scene--dirs" id="sDirs">
    <button class="dir-btn dir-dev" data-dir="dev" id="btnDev">Девелопмент</button>
    <div class="dir-line dir-dev-line"></div>
    <button class="dir-btn dir-fin" data-dir="fin" id="btnFin">Финансы</button>
    <div class="dir-line dir-fin-line"></div>
    <button class="dir-btn dir-re" data-dir="re" id="btnRe">Недвижимость</button>
    <div class="dir-line dir-re-line"></div>
  </div>

  <!-- Scene: Statement -->
  <div class="scene scene--stmt" id="sStmt">
    <h2>Не мнение.<br>Документированная логика.</h2>
    <p>Каждое решение — цепочка проверяемых шагов</p>
  </div>

  <!-- Scene: CTA -->
  <div class="scene scene--cta" id="sCta">
    <div class="cta-title">VZOR</div>
    <a class="cta-link" href="https://t.me/vzor_ai" target="_blank" rel="noopener">Telegram</a>
  </div>

</div>
</div>

<script>
(function(){
'use strict';

/* ═══ REFS ═══ */
const fractal   = document.getElementById('fractal');
const glow      = document.getElementById('glow');
const logo      = document.getElementById('logo');
const scrollInd = document.getElementById('scrollInd');
const arcsSvg   = document.getElementById('arcsSvg');
const labelsDiv = document.getElementById('dataLabels');

const sTitle = document.getElementById('sTitle');
const sTag   = document.getElementById('sTag');
const sDirs  = document.getElementById('sDirs');
const sStmt  = document.getElementById('sStmt');
const sCta   = document.getElementById('sCta');

const btnDev = document.getElementById('btnDev');
const btnFin = document.getElementById('btnFin');
const btnRe  = document.getElementById('btnRe');

/* ═══ UTILS ═══ */
const vh = () => window.innerHeight;
const lerp = (a,b,t) => a+(b-a)*t;
const clamp = (v,lo,hi) => Math.max(lo,Math.min(hi,v));
const ease = t => t<.5 ? 4*t*t*t : 1-Math.pow(-2*t+2,3)/2; // easeInOutCubic

/* ═══ ENTRY ANIMATION ═══ */
let entryDone = false;
setTimeout(()=>{
  fractal.classList.add('fractal-entered');
},200);
setTimeout(()=>{
  scrollInd.style.opacity='1';
  entryDone=true; // allow scroll handler to control fractal
},2800);

/* ═══ DIRECTION DATA ═══ */
const DIRS = {
  dev: {
    color:'#5B9EFF',
    colorAlpha:'rgba(91,158,255,',
    arcAngles:[
      {r:340, start:-160, end:-60, w:0.8},
      {r:370, start:-150, end:-80, w:0.5},
      {r:400, start:-170, end:-50, w:0.6},
      {r:430, start:-140, end:-70, w:0.4},
    ],
    labels:[
      {angle:-155, r:460, text:'Нормативный контроль'},
      {angle:-120, r:455, text:'Проверка СП и ГОСТ'},
      {angle:-90, r:460, text:'Экспертиза разделов'},
      {angle:-60, r:450, text:'Строительные нормативы'},
    ],
    metrics:[
      {angle:-140, r:415, text:'auto'},
      {angle:-75, r:418, text:'10 разделов'},
    ]
  },
  fin: {
    color:'#FBBF24',
    colorAlpha:'rgba(251,191,36,',
    arcAngles:[
      {r:340, start:-20, end:80, w:0.8},
      {r:370, start:-10, end:60, w:0.5},
      {r:400, start:-30, end:90, w:0.6},
      {r:430, start:0, end:70, w:0.4},
    ],
    labels:[
      {angle:-20, r:460, text:'Анализ рынков'},
      {angle:15, r:455, text:'Криптовалюты'},
      {angle:50, r:460, text:'Портфельные стратегии'},
      {angle:85, r:450, text:'Управление рисками'},
    ],
    metrics:[
      {angle:0, r:415, text:'24/7'},
      {angle:65, r:418, text:'мультифактор'},
    ]
  },
  re: {
    color:'#A78BFA',
    colorAlpha:'rgba(167,139,250,',
    arcAngles:[
      {r:340, start:100, end:200, w:0.8},
      {r:370, start:110, end:190, w:0.5},
      {r:400, start:95, end:210, w:0.6},
      {r:430, start:115, end:195, w:0.4},
    ],
    labels:[
      {angle:105, r:460, text:'Оценка объектов'},
      {angle:140, r:455, text:'Земельные участки'},
      {angle:170, r:460, text:'Инвестиционный анализ'},
      {angle:200, r:450, text:'Юридическая проверка'},
    ],
    metrics:[
      {angle:125, r:415, text:'ROI'},
      {angle:185, r:418, text:'due diligence'},
    ]
  }
};

/* ═══ SVG ARC GENERATOR ═══ */
function arcPath(cx,cy,r,startDeg,endDeg){
  const s = (startDeg-90)*Math.PI/180;
  const e = (endDeg-90)*Math.PI/180;
  const x1 = cx+r*Math.cos(s), y1 = cy+r*Math.sin(s);
  const x2 = cx+r*Math.cos(e), y2 = cy+r*Math.sin(e);
  const large = Math.abs(endDeg-startDeg)>180 ? 1 : 0;
  return `M${x1} ${y1} A${r} ${r} 0 ${large} 1 ${x2} ${y2}`;
}

function ptOnCircle(cx,cy,r,deg){
  const rad=(deg-90)*Math.PI/180;
  return{x:cx+r*Math.cos(rad),y:cy+r*Math.sin(rad)};
}

// Convert SVG viewBox coords → CSS % (accounts for aspect-ratio centering)
function svgToPct(sx,sy){
  const w=window.innerWidth,h=window.innerHeight,sz=Math.min(w,h);
  return{
    left:((w-sz)/2+sx*sz/1000)/w*100+'%',
    top:((h-sz)/2+sy*sz/1000)/h*100+'%'
  };
}

/* ═══ STATE ═══ */
let titleReady = false;
let activeDir = null;
let arcEls = [];
let dotEls = [];
let labelEls = [];
let metricEls = [];

function clearDirection(){
  arcEls.forEach(el=>{el.classList.remove('show');setTimeout(()=>el.remove(),600)});
  dotEls.forEach(el=>{el.classList.remove('show');setTimeout(()=>el.remove(),600)});
  labelEls.forEach(el=>{el.classList.remove('show');setTimeout(()=>el.remove(),500)});
  metricEls.forEach(el=>{el.classList.remove('show');setTimeout(()=>el.remove(),500)});
  arcEls=[];dotEls=[];labelEls=[];metricEls=[];
  glow.style.opacity='0';
  btnDev.classList.remove('active');
  btnFin.classList.remove('active');
  btnRe.classList.remove('active');
  activeDir=null;
}

function showDirection(key){
  if(activeDir===key){clearDirection();return;}
  clearDirection();
  activeDir=key;
  const d=DIRS[key];

  // Activate button
  document.querySelector(`[data-dir="${key}"]`).classList.add('active');

  // Glow
  glow.style.background=d.colorAlpha+'.12)';
  glow.style.opacity='1';

  // Create arcs
  d.arcAngles.forEach((a,i)=>{
    const path=document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d',arcPath(500,500,a.r,a.start,a.end));
    path.setAttribute('class','arc-path');
    path.setAttribute('stroke',d.colorAlpha+(0.15+a.w*0.2)+')');
    path.setAttribute('stroke-width',String(a.w));
    // Animate draw
    path.style.strokeDasharray='2000';
    path.style.strokeDashoffset='2000';
    arcsSvg.appendChild(path);
    arcEls.push(path);
    // Trigger animation
    requestAnimationFrame(()=>{
      path.classList.add('show');
      path.style.transition=`stroke-dashoffset ${1.2+i*0.2}s cubic-bezier(.22,1,.36,1), opacity .6s`;
      path.style.strokeDashoffset='0';
    });

    // Endpoint dots
    const p1=ptOnCircle(500,500,a.r,a.start);
    const p2=ptOnCircle(500,500,a.r,a.end);
    [p1,p2].forEach(pt=>{
      const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('cx',pt.x);c.setAttribute('cy',pt.y);
      c.setAttribute('r','2.5');
      c.setAttribute('fill',d.colorAlpha+'0.4)');
      c.setAttribute('class','arc-dot');
      arcsSvg.appendChild(c);
      dotEls.push(c);
      setTimeout(()=>c.classList.add('show'),300+i*100);
    });
  });

  // Data labels (positioned using SVG→viewport conversion)
  d.labels.forEach((lb,i)=>{
    const pt=ptOnCircle(500,500,lb.r,lb.angle);
    const pos=svgToPct(pt.x,pt.y);
    const el=document.createElement('div');
    el.className='data-label';
    el.dataset.c=key==='dev'?'blue':key==='fin'?'amber':'violet';
    el.textContent=lb.text;
    el.style.left=pos.left;
    el.style.top=pos.top;
    el.style.transitionDelay=(0.3+i*0.12)+'s';
    labelsDiv.appendChild(el);
    labelEls.push(el);
    requestAnimationFrame(()=>el.classList.add('show'));
  });

  // Metric badges
  d.metrics.forEach((m,i)=>{
    const pt=ptOnCircle(500,500,m.r,m.angle);
    const pos=svgToPct(pt.x,pt.y);
    const el=document.createElement('div');
    el.className='data-metric';
    el.textContent=m.text;
    el.style.left=pos.left;
    el.style.top=pos.top;
    el.style.transitionDelay=(0.5+i*0.15)+'s';
    labelsDiv.appendChild(el);
    metricEls.push(el);
    requestAnimationFrame(()=>el.classList.add('show'));
  });
}

/* ═══ DIRECTION CLICK HANDLERS ═══ */
btnDev.addEventListener('click',()=>showDirection('dev'));
btnFin.addEventListener('click',()=>showDirection('fin'));
btnRe.addEventListener('click',()=>showDirection('re'));

/* ═══ SCROLL CONTROLLER ═══ */
let ticking=false;

function onScroll(){
  ticking=false;
  const y=window.scrollY;
  const h=vh();
  const p=y/h; // progress in viewports (0 to ~4.2)

  // ─── Fractal opacity (transform is handled by tickMouse) ───
  const fOp=p<2.8 ? 1 : lerp(1,0.08,ease(clamp((p-2.8)/1,0,1)));
  if(entryDone||p>0.1){
    fractal.style.opacity=fOp;
  }

  // ─── Scroll indicator ───
  scrollInd.style.opacity=p<0.12?'1':'0';

  // ─── Logo: hidden at start, visible in mid, hidden at CTA ───
  let logoOp=0;
  if(p>0.7&&p<3.8) logoOp=clamp((p-0.7)/0.4,0,1);
  if(p>=3.8) logoOp=lerp(1,0,clamp((p-3.8)/0.3,0,1));
  logo.style.opacity=logoOp;

  // ─── Scene: Title ───
  let titleOp=0;
  if(!titleReady){titleOp=0;}
  else if(p<0.5){titleOp=1;}
  else{titleOp=lerp(1,0,ease(clamp((p-0.5)/0.4,0,1)));}
  sTitle.style.opacity=titleOp;

  // ─── Scene: Tagline ───
  let tagOp=0;
  if(p>0.8&&p<1.2) tagOp=ease(clamp((p-0.8)/0.35,0,1));
  else if(p>=1.2&&p<1.7) tagOp=1;
  else if(p>=1.7&&p<2.1) tagOp=lerp(1,0,ease(clamp((p-1.7)/0.35,0,1)));
  sTag.style.opacity=tagOp;

  // ─── Scene: Directions ───
  let dirOp=0;
  if(p>1.9&&p<2.3) dirOp=ease(clamp((p-1.9)/0.35,0,1));
  else if(p>=2.3&&p<3.2) dirOp=1;
  else if(p>=3.2&&p<3.5) dirOp=lerp(1,0,ease(clamp((p-3.2)/0.3,0,1)));
  sDirs.style.opacity=dirOp;
  sDirs.style.pointerEvents=dirOp>0.3?'auto':'none';

  // Also control arcs/labels visibility
  arcsSvg.style.opacity=dirOp;
  labelsDiv.style.opacity=dirOp;

  // Auto-clear direction when leaving dirs zone
  if(dirOp<0.1&&activeDir){clearDirection();}

  // ─── Scene: Statement ───
  let stmtOp=0;
  if(p>3.2&&p<3.6) stmtOp=ease(clamp((p-3.2)/0.35,0,1));
  else if(p>=3.6&&p<4.0) stmtOp=1;
  else if(p>=4.0&&p<4.3) stmtOp=lerp(1,0,ease(clamp((p-4.0)/0.3,0,1)));
  sStmt.style.opacity=stmtOp;

  // ─── Scene: CTA ───
  let ctaOp=0;
  if(p>4.0) ctaOp=ease(clamp((p-4.0)/0.4,0,1));
  sCta.style.opacity=ctaOp;
  sCta.style.pointerEvents=ctaOp>0.3?'auto':'none';
}

window.addEventListener('scroll',()=>{
  if(!ticking){requestAnimationFrame(onScroll);ticking=true;}
},{passive:true});

// Initial state
requestAnimationFrame(()=>{
  onScroll();
  // Delayed title reveal (after fractal enters)
  setTimeout(()=>{
    titleReady=true;
    sTitle.style.transition='opacity 1.2s cubic-bezier(.22,1,.36,1)';
    onScroll();
  },1800);
});

/* ═══ MOUSE INTERACTIVITY ═══ */

// Smoothed mouse position (0..1, center = 0.5)
let mx = 0.5, my = 0.5;       // target
let smx = 0.5, smy = 0.5;     // smoothed (current)
const SMOOTH = 0.08;           // lerp factor per frame

// Direction button colors for glow
const DIR_COLORS = {
  btnDev: {r:91, g:158, b:255},
  btnFin: {r:251, g:191, b:36},
  btnRe:  {r:167, g:139, b:250}
};

// Track mouse position
document.addEventListener('mousemove', e => {
  mx = e.clientX / window.innerWidth;
  my = e.clientY / window.innerHeight;
}, {passive: true});

// Reset when mouse leaves viewport
document.addEventListener('mouseleave', () => {
  mx = 0.5; my = 0.5;
}, {passive: true});

// Distance between two points (0..1 space)
function dist01(x1,y1,x2,y2){
  const dx = x1-x2, dy = y1-y2;
  return Math.sqrt(dx*dx+dy*dy);
}

// Get element center in 0..1 viewport coords
function elCenter(el){
  const r = el.getBoundingClientRect();
  return {
    x: (r.left + r.width/2) / window.innerWidth,
    y: (r.top + r.height/2) / window.innerHeight
  };
}

// Animation loop for mouse effects
let rafId;
const dirBtns = [
  {el: btnDev, id:'btnDev'},
  {el: btnFin, id:'btnFin'},
  {el: btnRe,  id:'btnRe'}
];

function tickMouse(){
  rafId = requestAnimationFrame(tickMouse);

  // Smooth interpolation
  smx = lerp(smx, mx, SMOOTH);
  smy = lerp(smy, my, SMOOTH);

  // Normalized offset from center (-1..1)
  const ox = (smx - 0.5) * 2;
  const oy = (smy - 0.5) * 2;

  // ─── Fractal: parallax shift + tilt + brightness ───
  const fShiftX = ox * -12;  // px, opposite direction for depth
  const fShiftY = oy * -12;
  const fRotY   = ox * 2.5;  // deg
  const fRotX   = oy * -2.5;

  // Brightness: brighter when mouse near center
  const distFromCenter = dist01(smx, smy, 0.5, 0.5);
  const bright = lerp(1.12, 0.95, clamp(distFromCenter / 0.5, 0, 1));

  // Compose fractal transform (combine with scroll scale)
  const y = window.scrollY;
  const h = vh();
  const p = y / h;
  const scrollScale = lerp(1, 1.22, clamp(p/3, 0, 1));

  if(entryDone || p > 0.1){
    fractal.style.transform =
      `scale(${scrollScale}) translate(${fShiftX}px, ${fShiftY}px) rotateY(${fRotY}deg) rotateX(${fRotX}deg)`;
    fractal.style.filter = `brightness(${bright})`;
  }

  // ─── Glow: parallax (slower, deeper layer) ───
  const gShiftX = ox * -6;
  const gShiftY = oy * -6;
  if(entryDone){
    glow.style.transform =
      `scale(${scrollScale}) translate(${gShiftX}px, ${gShiftY}px)`;
  }

  // ─── Direction buttons: proximity glow + magnetic shift ───
  dirBtns.forEach(({el, id}) => {
    const c = elCenter(el);
    const d = dist01(smx, smy, c.x, c.y);
    const proximity = clamp(1 - d / 0.25, 0, 1); // 1 = very close, 0 = far

    const col = DIR_COLORS[id];

    // Magnetic shift toward mouse (3px max)
    const pullX = (smx - c.x) * proximity * 20;
    const pullY = (smy - c.y) * proximity * 20;

    // Text shadow glow in direction color
    const glowR = Math.round(proximity * 15);
    const glowA = (proximity * 0.6).toFixed(2);

    // Letter spacing widens on proximity
    const ls = lerp(0.2, 0.32, proximity);

    el.style.transform =
      (id === 'btnRe' ? `translateX(-50%) ` : '') +
      `translate(${pullX}px, ${pullY}px)`;
    el.style.textShadow = proximity > 0.01
      ? `0 0 ${glowR}px rgba(${col.r},${col.g},${col.b},${glowA})`
      : '0 0 0px transparent';
    el.style.letterSpacing = ls + 'em';

    // Brighten color on proximity (if not already active/hovered by CSS)
    if(!el.classList.contains('active')){
      const alpha = lerp(0.35, 0.75, proximity);
      el.style.color = `rgba(255,255,255,${alpha})`;
    }
  });
}

// Start mouse animation loop
tickMouse();

})();
</script>

</body>
</html>
